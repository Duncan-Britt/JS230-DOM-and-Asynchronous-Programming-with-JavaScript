<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>Exercise1</title>
</head>
<script type="text/javascript">
  function availableSchedules() {
    const request = new XMLHttpRequest();
    request.open('GET', 'http://localhost:3000/api/schedules');
    request.timeout = 5000;
    request.responseType = 'json';

    request.addEventListener('load', event => {
      let data = request.response;
      if (data.length === 0) {
        alert("There are currently no schedules available for booking");
        return;
      }

      const staffSchedules = {};
      data.forEach(schedule => {
        const key = 'staff ' + schedule.staff_id;
        staffSchedules[key] = staffSchedules[key] || 0;
        staffSchedules[key]++;
      });

      let scheduleStr = Object.keys(staffSchedules).map(key => {
        return `${key}: ${staffSchedules[key]}`
      }).join('\n');
      alert(scheduleStr);
    });

    request.addEventListener('timeout', () => {
      alert("The request timed out")
    });

    request.addEventListener('loadend', () => {
      alert("The request completed.");
    });

    request.send();
  }
</script>
<body>
</body>
</html>
